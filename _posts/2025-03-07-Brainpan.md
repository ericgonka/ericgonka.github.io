---
title: "Brainpan 1 - Writeup"
date: 2025-03-07
author: "Eric González"
---
![image](https://github.com/user-attachments/assets/166cbca0-b5ee-4c77-9840-149691e16467)

## Introducción

**Brainpan 1** es una máquina de nivel principiante/intermedio en TryHackMe (THM) diseñada para practicar explotación de binarios y ejecución de código remoto. En este writeup, analizaremos los pasos clave para comprometer la máquina, desde el reconocimiento hasta la escalación de privilegios.

## Herramientas 

* [Kali](https://www.kali.org/)
* [Nmap](https://nmap.org/)
* [dirb](https://dirb.sourceforge.net/about.html)
* [netcat](https://netcat.sourceforge.net/)
* [IDA Free](https://www.hex-rays.com/products/ida/support/download_freeware.shtml)
* [gdb](https://www.gnu.org/software/gdb/)
* [gdb-peda](https://github.com/longld/peda)
* [Metasploit Framework](https://www.metasploit.com/)
* [Python](https://www.python.org/)

## Detalles

* Attacker IP: 10.9.2.48
* Target VM Type: VirtualBox
* Target IP: 10.10.253.211
* Target Network: VirtualBox Bridge

## Enumeración

Comenzamos con un escaneo de puertos para identificar servicios en ejecución:

```bash
nmap -sS --min-rate 5000 -n -Pn 192.168.1.214
```
![{40A1D7E2-8295-4ACA-8110-E9480ED884D7}](https://github.com/user-attachments/assets/7c51afa6-bed8-468c-90b2-6d7838e334ca)

```bash
nmap -sCV --min-rate 5000 -p9999,10000 -n -Pn -v 192.168.1.214
```

Result:

```
PORT      STATE SERVICE VERSION
9999/tcp  open  abyss?
| fingerprint-strings: 
|   NULL: 
|     _| _| 
|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| 
|     _|_| _| _| _| _| _| _| _| _| _| _| _|
|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|
|     [________________________ WELCOME TO BRAINPAN _________________________]
|_    ENTER THE PASSWORD
10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)
|_http-server-header: SimpleHTTP/0.6 Python/2.7.3
|_http-title: Site doesn't have a title (text/html).
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9999-TCP:V=7.95%I=7%D=3/7%Time=67CAEC23%P=x86_64-pc-linux-gnu%r(NUL
SF:L,298,"_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\n_\|_\|_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|\x20\x20\x20\x20_\|_\|_\|\
SF:x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x
SF:20\x20\x20_\|_\|_\|\x20\x20_\|_\|_\|\x20\x20\n_\|\x20\x20\x20\x20_\|\x2
SF:0\x20_\|_\|\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x2
SF:0\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x2
SF:0\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|\x20\x20\x20\x20_\|\
SF:x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x2
SF:0_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x2
SF:0_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|_\|_\|\x20\x2
SF:0\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20_\
SF:|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|_\|\x20\x20\x20\x20\x20\x2
SF:0_\|_\|_\|\x20\x20_\|\x20\x20\x20\x20_\|\n\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x20\x20
SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
SF:20\x20_\|\n\n\[________________________\x20WELCOME\x20TO\x20BRAINPAN\x2
SF:0_________________________\]\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ENTER\x2
SF:0THE\x20PASSWORD\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\n\x
SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
SF:x20\x20\x20\x20\x20\x20\x20\x20>>\x20");
MAC Address: 08:00:27:F7:40:53 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)

NSE: Script Post-scanning.
Initiating NSE at 13:53
Completed NSE at 13:53, 0.00s elapsed
Initiating NSE at 13:53
Completed NSE at 13:53, 0.00s elapsed
Initiating NSE at 13:53
Completed NSE at 13:53, 0.00s elapsed
Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 37.85 seconds
           Raw packets sent: 3 (116B) | Rcvd: 3 (116B)

```

Vemos que el puerto 1000 corresponde a un servicio web.
Solo és un gráfico informativo que muestra información sobre codificación segura. Ver el código fuente de la página tampoco arrojó nada útil.

![{1A1CC53E-A9C9-440E-9D88-E001D3A80B07}](https://github.com/user-attachments/assets/4869d4bc-23a6-480c-9f7a-75e0baa43183)

Ahora veamos si dirb puede encontrar algo útil que no esté indexado desde la página principal

```bash
dirb http://192.168.56.101:10000
```

```
START_TIME: Thu Dec 27 21:34:36 2018
URL_BASE: http://192.168.56.101:10000/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

-----------------

GENERATED WORDS: 4612                                                          

---- Scanning URL: http://192.168.56.101:10000/ ----
+ http://192.168.56.101:10000/bin (CODE:301|SIZE:0)                                                                                                                                    
+ http://192.168.56.101:10000/index.html (CODE:200|SIZE:215)                                                                                                                           
                                                                                                                                                                                       
-----------------
END_TIME: Thu Dec 27 21:34:42 2018
DOWNLOADED: 4612 - FOUND: 2
-----------------
```

Interesante. Tenemos una carpeta bin, vamos a verla.

![{333C90EC-BB7E-4981-94A4-CC29A98C3E92}](https://github.com/user-attachments/assets/a2977ed8-820c-42c8-b323-5e49e0b326f1)

La lista de directorios está habilitada y tenemos un solo archivo presente, **brainpan.exe**. Sigamos adelante y descarguemos el archivo.

Vemos que es un archivo ejecutable, lo pasaremos a nuestra máquina **Windows** para analizarlo y verlo más a fondo.

![{FD856F61-08C2-4204-85C3-0413E66C9E69}](https://github.com/user-attachments/assets/26cb397e-23aa-4428-8b0f-c9b6e13063f7)

Para ello nos montamos un servicio web con python y desde la máquina windows nos decargamos el binario.

![{3B73E7DD-52B8-4E15-8692-D88CA6EFF0A7}](https://github.com/user-attachments/assets/d131a918-2fd0-4eb3-894a-090ececa6639)

Accedemos desde el navegador a la ip de nuestra máquina **kali** y lo descargamos.

![{CBD3E379-C987-4321-BA5E-F31219623B8B}](https://github.com/user-attachments/assets/f7bd0490-e0b3-45ba-8e95-57cd53610133)

Una vez descargado el binario, ejecutamos el **-exe** y analizamos el servicio con el **Immunity Debugger**.

![{5A07D556-78A6-4886-8E52-48649E4BD079}](https://github.com/user-attachments/assets/a1c24bd7-3a85-41a1-a1b7-6c67db740507)

Seleccionamos **Attach**, seleccionamos el servicio y lo ponemos en marcha.

![{A8637CD7-4ABD-4785-A2D8-E4ABB3AE13A5}](https://github.com/user-attachments/assets/54097693-0b76-4ace-968e-ed8b5513dca3)

Ahí vemos toda la información.

![{383A3AF3-324E-4202-97F9-BEB65A0B6E67}](https://github.com/user-attachments/assets/030a212f-1647-4df7-a5e5-3aa46fffeddb)

## Explotación

Procedemos a hacer pruevas con el servicio activo **brainpan** de nuestra máquina Windows, primero nos conectamos al puerto **9999**

Nos conectamos via netcat, y vemos que nos pide una contraseña.
Probamos de poner "AAAAAAA..." a ver que resultado obtenemos en el servicio.

```bash
nc 192.168.1.212 9999
```

![{7172BD75-0C64-4DB1-824B-EE9E322833B4}](https://github.com/user-attachments/assets/6a1fc54a-01eb-495c-8ed7-435468bde3dd)

Volvemos al **Immunity Debugger** y vemos que ha petado y no nos deja volver a conectarnos.
Las **A** bloquean el programa y sobrescriben el puntero de instrucción, podemos ver esto en Immunity Debugger donde se sobrescribe el EIP con 41414141:

![{64BEE0D4-A0EC-4A94-A036-273CBD041F82}](https://github.com/user-attachments/assets/bb4584c7-5828-4710-9025-dee168f33f5b)

Ahora sabemos que el parámetro de contraseña es vulnerable a un BufferOverflow, pero necesitamos una idea de cuántos caracteres lo bloquean **(OFFSET)**.
Para ello utilizaremos el **pattern_create.rb** de Metasploit

```bash
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000
```

![{482CE7B1-B5AC-4A1A-B4EF-1E45F87C0210}](https://github.com/user-attachments/assets/2e5d7a5c-159c-44fa-9f73-506704690687)

Volvemos a abrir el servicio y lo iniciamos.
Luego enviamos los 1000 carácteres que nos ha generado metasploit.

![{F558FB66-C165-4282-B207-0D4211FFC4EA}](https://github.com/user-attachments/assets/634d0c35-6388-472e-99a5-0021ca5cc466)

Vemos que vuelve a petar pero esta vez nos quedamos con el número que nos pone en el registro **EIP**.
En este caso **35724134**.

![{CA66AFCC-1492-4A9C-B159-F774B0251DB1}](https://github.com/user-attachments/assets/53aeb71c-16d4-4935-a73f-1bc9545627c4)

Ahora con el **pattern_offset.rb** vemos el número exacto de "bytes" que peta el programa y podemos empezar a sobreescribir el EIP.

![{0EC5D901-B46D-4223-B4C8-4258DA380FC5}](https://github.com/user-attachments/assets/81f01165-130e-4765-9fe0-e4e64e3755d5)

Generamos el número de "A" que hemos obtenido anteriormente y le sumamos 4 "B".

```bash
python -c 'print("A"*524 + "B"*4)'
```

![{EB6C6B35-AAA5-445B-BCCC-EBE839C450DA}](https://github.com/user-attachments/assets/ccbd065e-f0be-4c48-b61b-8230690c22f8)


Lo enviamos y vemos que las "B" caen exactamente en el registro **EIP** ya que las B en hexadecimal equivalen a "42".

![{46FF3F92-C0F3-4E24-BB60-0BD02F40F8A3}](https://github.com/user-attachments/assets/de952e99-6d34-4792-9c4c-97a8d0c89983)

Ahora probaremos a añadir 10 C para ver a donde van.

![{51CBD202-DE4C-4DC0-8385-FB7C4EE489B6}](https://github.com/user-attachments/assets/219b23bf-5024-48a8-a678-8c713365932a)

Vemos que efectivamente sobreescribe el servicio **ESP**

![{052FDDC7-346C-4A88-B537-5893504587C5}](https://github.com/user-attachments/assets/ba9c9e7c-cfee-4078-a869-9556c7f23740)

Ahora ya podemos crear el script para ir encaminando la intrusión:







